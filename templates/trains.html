{% extends "base.html" %}

{% block content %}
<div class="glass-card mb-4">
    <h2 class="mb-3">Book Trains</h2>
    <form method="POST" class="flight-inputs-grid">
        <div class="form-group">
            <label>From</label>
            <select name="from_city" class="form-control js-custom-select" required>
                <option value="">Select</option>
                {% for city in departure_cities %}
                <option value="{{ city }}" {% if city==from_city %}selected{% endif %}>{{ city }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label>To</label>
            <select name="to_city" class="form-control js-custom-select" required>
                <option value="">Select</option>
                {% for city in arrival_cities %}
                <option value="{{ city }}" {% if city==to_city %}selected{% endif %}>{{ city }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label>Date</label>
            <input type="date" name="travel_date" class="form-control" value="{{ travel_date or '' }}" required>
        </div>
        <div class="form-group">
            <label>Class</label>
            <select name="travel_class" class="form-control js-custom-select">
                <option value="Economy" {% if travel_class=='Economy' %}selected{% endif %}>Economy</option>
                <option value="Premium" {% if travel_class=='Premium' %}selected{% endif %}>Premium</option>
                <option value="Business" {% if travel_class=='Business' %}selected{% endif %}>Business</option>
            </select>
        </div>
        <div class="form-group">
            <label>Travellers</label>
            <input type="number" min="1" name="travellers" class="form-control" value="{{ travellers }}">
        </div>
        <div class="form-group" style="align-self: end;">
            <button type="submit" class="btn btn-primary w-100">Search Trains</button>
        </div>
    </form>
</div>

{% if trains %}
<div class="row">
    {% for item in trains %}
    <div class="col-md-6 mb-4">
        <div class="glass-card flight-result-card" style="padding: 1.5rem;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 style="margin: 0; color: var(--primary-color);">{{ item.train.operator }}</h3>
                    <small style="color: rgba(255,255,255,0.6);">{{ item.train.train_number }}</small>
                </div>
                <div style="text-align: right;">
                    <span style="font-size: 1.4rem; font-weight: 700; color: #fff;">₹{{ item.per_person }}</span>
                    <p class="text-muted" style="margin: 0;">per person</p>
                    {% if travellers|int > 1 %}
                    <div style="margin-top: 0.5rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 0.2rem;">
                        <span style="font-size: 0.9rem; color: var(--primary-color);">Total: ₹{{ item.total }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>

            <div style="display: flex; gap: 2rem; margin: 1.5rem 0; align-items: center;">
                <div style="flex: 1; text-align: center;">
                    <span style="display: block; font-size: 1.1rem; font-weight: 600;">{{ item.train.departure_time }}</span>
                    <small style="color: var(--primary-color);">{{ item.train.departure_city }}</small>
                </div>
                <div style="flex: 1; text-align: center; position: relative;">
                    <div style="height: 1px; background: rgba(255,255,255,0.2); width: 100%; position: absolute; top: 50%;"></div>
                </div>
                <div style="flex: 1; text-align: center;">
                    <span style="display: block; font-size: 1.1rem; font-weight: 600;">(Arrival)</span>
                    <small style="color: var(--primary-color);">{{ item.train.arrival_city }}</small>
                </div>
            </div>

            <a href="{{ url_for('train_checkout', train_id=item.train.id, date=travel_date, travellers=travellers, travel_class=travel_class) }}"
                class="btn btn-primary" style="width: 100%;">Select Train</a>
        </div>
    </div>
    {% endfor %}
</div>
{% elif searched %}
<div class="glass-card text-center">
    <p>No trains found for this route. Try another search.</p>
</div>
{% endif %}
{% endblock %}

